<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gun Game</title>
  <style>
    body { margin: 0; background: #222; overflow: hidden; color: white; font-family: Arial, sans-serif; }
    canvas { background: #111; display: block; margin: 0 auto; border: 2px solid #444; }
    #ui {
      position: fixed;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 10px;
    }
    button {
      padding: 10px 15px;
      font-size: 16px;
      cursor: pointer;
      background: #333;
      color: white;
      border: 1px solid #555;
      border-radius: 5px;
      transition: background 0.3s;
    }
    button:hover { background: #555; }
    #score {
      position: fixed;
      top: 10px;
      left: 10px;
      font-size: 20px;
      font-weight: bold;
    }
    #health {
      position: fixed;
      top: 10px;
      right: 10px;
      font-size: 20px;
      font-weight: bold;
    }
    #wave {
      position: fixed;
      top: 40px;
      left: 10px;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas" width="800" height="600"></canvas>
  <div id="score">Score: 0</div>
  <div id="health">Health: 100</div>
  <div id="wave">Wave: 1</div>
  <div id="ui">
    <button id="pistolBtn">Pistol</button>
    <button id="shotgunBtn">Shotgun</button>
    <button id="rifleBtn">Rifle</button>
  </div>

  <script>
    // Sound URLs from your GitHub repo
    const soundBase = 'https://raw.githubusercontent.com/northernstar001-ctrl/northernstar001-ctrl.github.io/main/';
    const sounds = {
      pistol: new Audio(soundBase + 'pistol.mp3'),
      shotgun: new Audio(soundBase + 'shotgun.mp3'),
      rifle: new Audio(soundBase + 'Reload.mp3'),  // Assuming rifle sound here; change if needed
      reload: new Audio(soundBase + 'Refile.mp3'),
      enemyHit: new Audio(soundBase + 'Enemy hit.mp3'),
      bossHit: new Audio(soundBase + 'Boss hit.mp3'),
      explosion: new Audio(soundBase + 'explosion.mp3'),
      playerHit: new Audio(soundBase + 'Player hit.mp3'),
      bgMusic: new Audio(soundBase + 'Background music.mp3'),
    };
    sounds.bgMusic.loop = true;
    sounds.bgMusic.volume = 0.2;
    sounds.bgMusic.play();

    // Canvas setup
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    // Game variables
    let player = { x: 400, y: 300, radius: 20, speed: 4, health: 100 };
    let keys = {};
    let bullets = [];
    let enemies = [];
    let boss = null;
    let score = 0;
    let wave = 1;
    let currentGun = 'pistol';
    let canShoot = true;

    // UI Elements
    const scoreEl = document.getElementById('score');
    const healthEl = document.getElementById('health');
    const waveEl = document.getElementById('wave');

    // Controls setup
    document.addEventListener('keydown', e => {
      keys[e.key.toLowerCase()] = true;

      // Gun switching keys
      if (e.key === '1') switchGun('pistol');
      if (e.key === '2') switchGun('shotgun');
      if (e.key === '3') switchGun('rifle');
    });
    document.addEventListener('keyup', e => {
      keys[e.key.toLowerCase()] = false;
    });

    // Mouse shooting
    canvas.addEventListener('mousedown', shoot);

    // Mobile buttons
    document.getElementById('pistolBtn').addEventListener('click', () => switchGun('pistol'));
    document.getElementById('shotgunBtn').addEventListener('click', () => switchGun('shotgun'));
    document.getElementById('rifleBtn').addEventListener('click', () => switchGun('rifle'));

    // Switch gun function
    function switchGun(gun) {
      if (currentGun !== gun) {
        currentGun = gun;
        // Play reload sound
        sounds.reload.play();
      }
    }

    // Shoot function
    function shoot(e) {
      if (!canShoot) return;
      canShoot = false;

      let mx, my;
      if (e) {
        const rect = canvas.getBoundingClientRect();
        mx = e.clientX - rect.left;
        my = e.clientY - rect.top;
      } else {
        mx = player.x + 1;
        my = player.y;
      }

      switch (currentGun) {
        case 'pistol':
          sounds.pistol.play();
          createBullet(mx, my, 10, 5);
          break;
        case 'shotgun':
          sounds.shotgun.play();
          for (let angle = -15; angle <= 15; angle += 15) {
            createBullet(mx, my, 7, 8, angle);
          }
          break;
        case 'rifle':
          sounds.rifle.play();
          createBullet(mx, my, 15, 3);
          break;
      }

      setTimeout(() => (canShoot = true), currentGun === 'shotgun' ? 700 : 300);
    }

    // Bullet constructor
    function createBullet(mx, my, speed, radius, angleDeg = 0) {
      const angle = Math.atan2(my - player.y, mx - player.x) + (angleDeg * Math.PI) / 180;
      bullets.push({
        x: player.x,
        y: player.y,
        dx: Math.cos(angle) * speed,
        dy: Math.sin(angle) * speed,
        radius: radius,
      });
    }

    // Enemy constructor
    function createEnemy(type = 'normal') {
      const size = type === 'boss' ? 50 : 20;
      const speed = type === 'boss' ? 1 : 2 + wave * 0.3;
      const hp = type === 'boss' ? 50 + wave * 10 : 3 + wave;

      let x, y;
      const edge = Math.floor(Math.random() * 4);
      if (edge === 0) {
        x = 0;
        y = Math.random() * canvas.height;
      } else if (edge === 1) {
        x = canvas.width;
        y = Math.random() * canvas.height;
      } else if (edge === 2) {
        x = Math.random() * canvas.width;
        y = 0;
      } else {
        x = Math.random() * canvas.width;
        y = canvas.height;
      }

      return { x, y, radius: size, speed, hp, type };
    }

    // Spawn enemies
    function spawnWave() {
      enemies = [];
      boss = null;
      for (let i = 0; i < wave * 5; i++) {
        enemies.push(createEnemy());
      }
      if (wave % 5 === 0) {
        boss = createEnemy('boss');
      }
    }

    // Game loop
    function gameLoop() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Move player
      if (keys['w'] || keys['arrowup']) player.y -= player.speed;
      if (keys['s'] || keys['arrowdown']) player.y += player.speed;
      if (keys['a'] || keys['arrowleft']) player.x -= player.speed;
      if (keys['d'] || keys['arrowright']) player.x += player.speed;

      // Clamp player to canvas bounds
      player.x = Math.max(player.radius, Math.min(canvas.width - player.radius, player.x));
      player.y = Math.max(player.radius, Math.min(canvas.height - player.radius, player.y));

      // Draw player
      ctx.fillStyle = 'cyan';
      ctx.beginPath();
      ctx.arc(player.x, player.y, player.radius, 0, Math.PI * 2);
      ctx.fill();

      // Update and draw bullets
      for (let i = bullets.length - 1; i >= 0; i--) {
        const b = bullets[i];
        b.x += b.dx;
        b.y += b.dy;

        // Remove bullets outside canvas
        if (b.x < 0 || b.x > canvas.width || b.y < 0 || b.y > canvas.height) {
          bullets.splice(i, 1);
          continue;
        }

        ctx.fillStyle = 'yellow';
        ctx.beginPath();
        ctx.arc(b.x, b.y, b.radius, 0, Math.PI * 2);
        ctx.fill();
      }

      // Move and draw enemies
      for (let i = enemies.length - 1; i >= 0; i--) {
        const e = enemies[i];

        // Move enemy toward player
        const angle = Math.atan2(player.y - e.y, player.x - e.x);
        e.x += Math.cos(angle) * e.speed;
        e.y += Math.sin(angle) * e.speed;

        // Draw enemy
        ctx.fillStyle = e.type === 'boss' ? 'red' : 'orange';
        ctx.beginPath();
        ctx.arc(e.x, e.y, e.radius, 0, Math.PI * 2);
        ctx.fill();

        // Check collision with player
        const distToPlayer = Math.hypot(player.x - e.x, player.y - e.y);
        if (distToPlayer < player.radius + e.radius) {
          player.health -= e.type === 'boss' ? 10 : 2;
          sounds.playerHit.play();
          enemies.splice(i, 1);
          if (player.health <= 0) {
            alert('Game Over! Your score: ' + score);
            resetGame();
            return;
          }
          healthEl.textContent = 'Health: ' + player.health;
          continue;
        }

        // Check collision with bullets
        for (let j = bullets.length - 1; j >= 0; j--) {
          const b = bullets[j];
          const dist = Math.hypot(b.x - e.x, b.y - e.y);
          if (dist < b.radius + e.radius) {
            e.hp--;
            bullets.splice(j, 1);
            if (e.hp <= 0) {
              score += e.type === 'boss' ? 50 : 10;
              sounds.enemyHit.play();
              if (e.type === 'boss') {
                sounds.explosion.play();
                boss = null;
              }
              enemies.splice(i, 1);
              scoreEl.textContent = 'Score: ' + score;
              if (enemies.length === 0 && !boss) {
                wave++;
                waveEl.textContent = 'Wave: ' + wave;
                spawnWave();
              }
            } else {
              if (e.type === 'boss') sounds.bossHit.play();
              else sounds.enemyHit.play();
            }
            break;
          }
        }
      }

      // Draw boss health bar
      if (boss) {
        ctx.fillStyle = 'black';
        ctx.fillRect(10, 10, 200, 20);
        ctx.fillStyle = 'red';
        ctx.fillRect(10, 10, 200 * (boss.hp / (50 + wave * 10)), 20);
        ctx.strokeStyle = 'white';
        ctx.strokeRect(10, 10, 200, 20);
      }

      requestAnimationFrame(gameLoop);
    }

    // Reset game
    function resetGame() {
      player.health = 100;
      score = 0;
      wave = 1;
      scoreEl.textContent = 'Score: 0';
      healthEl.textContent = 'Health: 100';
      waveEl.textContent = 'Wave: 1';
      bullets = [];
      enemies = [];
      boss = null;
      spawnWave();
    }

    // Start game
    spawnWave();
    gameLoop();
  </script>
</body>
</html>
